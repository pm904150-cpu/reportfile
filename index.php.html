<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ट्रेडिंग P/L रिपोर्ट जनरेटर</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 20px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .output-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h2 {
            color: #1a2a6c;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1a2a6c;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #1a2a6c;
            outline: none;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-btn {
            background: linear-gradient(to right, #00b09b, #96c93d);
            color: white;
        }
        
        .reset-btn {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .trades-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }
        
        .trade-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .trade-item:last-child {
            border-bottom: none;
        }
        
        .trade-item .symbol {
            font-weight: bold;
        }
        
        .trade-item .profit {
            color: #00b09b;
            font-weight: bold;
        }
        
        .trade-item .loss {
            color: #ff416c;
            font-weight: bold;
        }
        
        .delete-btn {
            background: #ff416c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .report-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #f5f7fa, #e4e7f0);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .summary-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #555;
        }
        
        .summary-card .value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .profit-value {
            color: #00b09b;
        }
        
        .loss-value {
            color: #ff416c;
        }
        
        .chart-container {
            height: 200px;
            margin: 30px 0;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
        }
        
        .trade-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .trade-table th {
            background: #1a2a6c;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .trade-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .trade-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .trade-table .profit {
            color: #00b09b;
            font-weight: bold;
        }
        
        .trade-table .loss {
            color: #ff416c;
            font-weight: bold;
        }
        
        .export-btn {
            background: linear-gradient(to right, #1a2a6c, #4a6fc9);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        .position-tracker {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .position-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .position-item:last-child {
            border-bottom: none;
        }
        
        .settings-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .settings-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .settings-row {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> <span id="appTitle">ट्रेडिंग P/L रिपोर्ट जनरेटर</span></h1>
            <p id="appDescription">अपने ट्रेडिंग प्रदर्शन का विश्लेषण करें और वास्तविक P/L रिपोर्ट उत्पन्न करें</p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <h2><i class="fas fa-plus-circle"></i> <span id="addTradeHeader">नया ट्रेड जोड़ें</span></h2>
                
                <div class="form-group">
                    <label for="symbol"><i class="fas fa-tag"></i> <span id="instrumentLabel">स्टॉक/इंस्ट्रूमेंट</span></label>
                    <input type="text" id="symbol" placeholder="जैसे: RELIANCE, INFY, TCS">
                </div>
                
                <div class="form-group">
                    <label for="type"><i class="fas fa-exchange-alt"></i> <span id="tradeTypeLabel">ट्रेड प्रकार</span></label>
                    <select id="type">
                        <option value="buy">खरीदें (Buy)</option>
                        <option value="sell">बेचें (Sell)</option>
                    </select>
                </div>
                
                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="quantity"><i class="fas fa-sort-amount-up"></i> <span id="quantityLabel">मात्रा</span></label>
                        <input type="number" id="quantity" min="1" value="100">
                    </div>
                    
                    <div class="form-group" style="flex: 1;">
                        <label for="price"><i class="fas fa-rupee-sign"></i> <span id="priceLabel">प्रति यूनिट मूल्य</span></label>
                        <input type="number" id="price" min="0" step="0.01" placeholder="₹">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="date"><i class="far fa-calendar-alt"></i> <span id="dateLabel">तारीख</span></label>
                    <input type="date" id="date">
                </div>
                
                <div class="btn-group">
                    <button class="add-btn" id="addTrade">
                        <i class="fas fa-plus"></i> <span id="addTradeBtn">ट्रेड जोड़ें</span>
                    </button>
                    <button class="reset-btn" id="resetForm">
                        <i class="fas fa-redo"></i> <span id="resetBtn">रीसेट करें</span>
                    </button>
                </div>
                
                <h3 style="margin-top: 20px;"><i class="fas fa-list"></i> <span id="tradeListHeader">ट्रेड्स की सूची</span></h3>
                <div class="trades-list" id="tradesList">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p id="noTradesText">कोई ट्रेड नहीं मिला</p>
                        <p id="addTradePrompt">ट्रेड जोड़ने के लिए ऊपर फॉर्म का उपयोग करें</p>
                    </div>
                </div>
                
                <div class="position-tracker">
                    <h3><i class="fas fa-boxes"></i> <span id="positionHeader">करंट पोजीशन</span></h3>
                    <div id="positionsContainer">
                        <div class="empty-state" style="padding: 15px;">
                            <i class="fas fa-box-open"></i>
                            <p id="noPositionText">कोई सक्रिय पोजीशन नहीं</p>
                        </div>
                    </div>
                </div>
                
                <div class="settings-panel">
                    <h3><i class="fas fa-cog"></i> <span id="settingsHeader">सेटिंग्स</span></h3>
                    <div class="settings-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="currency"><i class="fas fa-money-bill-wave"></i> <span id="currencyLabel">करेंसी</span></label>
                            <select id="currency">
                                <option value="INR">भारतीय रुपया (₹)</option>
                                <option value="USD">अमेरिकी डॉलर ($)</option>
                                <option value="EUR">यूरो (€)</option>
                                <option value="GBP">ब्रिटिश पाउंड (£)</option>
                                <option value="JPY">जापानी येन (¥)</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="flex: 1;">
                            <label for="language"><i class="fas fa-language"></i> <span id="languageLabel">भाषा</span></label>
                            <select id="language">
                                <option value="hi">हिंदी</option>
                                <option value="en">English</option>
                                <option value="es">Español</option>
                                <option value="fr">Français</option>
                                <option value="de">Deutsch</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="output-section">
                <h2><i class="fas fa-file-alt"></i> <span id="reportHeader">P/L रिपोर्ट सारांश</span></h2>
                
                <div class="report-card">
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h3 id="totalProfitLabel">कुल लाभ</h3>
                            <div class="value profit-value" id="totalProfit">₹0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3 id="totalLossLabel">कुल हानि</h3>
                            <div class="value loss-value" id="totalLoss">₹0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3 id="netPLLabel">शुद्ध P/L</h3>
                            <div class="value" id="netPL">₹0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3 id="winRateLabel">सफलता दर</h3>
                            <div class="value" id="winRate">0%</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;"><span id="monthlyPerfLabel">मासिक प्रदर्शन</span></h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <h2><i class="fas fa-table"></i> <span id="tradeDetailsHeader">सभी ट्रेड्स की विस्तृत सूची</span></h2>
                <div class="report-card">
                    <table class="trade-table" id="tradeTable">
                        <thead>
                            <tr>
                                <th id="instrumentHeader">इंस्ट्रूमेंट</th>
                                <th id="typeHeader">प्रकार</th>
                                <th id="quantityHeader">मात्रा</th>
                                <th id="priceHeader">मूल्य</th>
                                <th id="dateHeader">तारीख</th>
                                <th id="plHeader">P/L</th>
                                <th id="actionHeader">क्रिया</th>
                            </tr>
                        </thead>
                        <tbody id="tradeTableBody">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-table"></i>
                                    <p id="noDataText">कोई ट्रेड डेटा उपलब्ध नहीं है</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <button class="export-btn" id="exportBtn">
                        <i class="fas fa-download"></i> <span id="exportBtnText">रिपोर्ट डाउनलोड करें (CSV)</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ट्रेड्स को स्टोर करने के लिए
        let trades = JSON.parse(localStorage.getItem('trades')) || [];
        
        // यूजर सेटिंग्स
        let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
            currency: 'INR',
            language: 'hi'
        };
        
        // करेंसी सिंबल
        const currencySymbols = {
            'INR': '₹',
            'USD': '$',
            'EUR': '€',
            'GBP': '£',
            'JPY': '¥'
        };
        
        // भाषा अनुवाद
        const translations = {
            'hi': {
                appTitle: "ट्रेडिंग P/L रिपोर्ट जनरेटर",
                appDescription: "अपने ट्रेडिंग प्रदर्शन का विश्लेषण करें और वास्तविक P/L रिपोर्ट उत्पन्न करें",
                addTradeHeader: "नया ट्रेड जोड़ें",
                instrumentLabel: "स्टॉक/इंस्ट्रूमेंट",
                tradeTypeLabel: "ट्रेड प्रकार",
                quantityLabel: "मात्रा",
                priceLabel: "प्रति यूनिट मूल्य",
                dateLabel: "तारीख",
                addTradeBtn: "ट्रेड जोड़ें",
                resetBtn: "रीसेट करें",
                tradeListHeader: "ट्रेड्स की सूची",
                noTradesText: "कोई ट्रेड नहीं मिला",
                addTradePrompt: "ट्रेड जोड़ने के लिए ऊपर फॉर्म का उपयोग करें",
                positionHeader: "करंट पोजीशन",
                noPositionText: "कोई सक्रिय पोजीशन नहीं",
                settingsHeader: "सेटिंग्स",
                currencyLabel: "करेंसी",
                languageLabel: "भाषा",
                reportHeader: "P/L रिपोर्ट सारांश",
                totalProfitLabel: "कुल लाभ",
                totalLossLabel: "कुल हानि",
                netPLLabel: "शुद्ध P/L",
                winRateLabel: "सफलता दर",
                monthlyPerfLabel: "मासिक प्रदर्शन",
                tradeDetailsHeader: "सभी ट्रेड्स की विस्तृत सूची",
                instrumentHeader: "इंस्ट्रूमेंट",
                typeHeader: "प्रकार",
                quantityHeader: "मात्रा",
                priceHeader: "मूल्य",
                dateHeader: "तारीख",
                plHeader: "P/L",
                actionHeader: "क्रिया",
                exportBtnText: "रिपोर्ट डाउनलोड करें (CSV)",
                noDataText: "कोई ट्रेड डेटा उपलब्ध नहीं है",
                fillAllFields: "कृपया सभी फ़ील्ड भरें",
                noDataExport: "एक्सपोर्ट करने के लिए कोई डेटा नहीं है",
                buy: "खरीदें",
                sell: "बेचें",
                delete: "हटाएँ",
                jan: "जनवरी",
                feb: "फरवरी",
                mar: "मार्च",
                apr: "अप्रैल",
                may: "मई",
                jun: "जून",
                jul: "जुलाई",
                aug: "अगस्त",
                sep: "सितंबर",
                oct: "अक्टूबर",
                nov: "नवंबर",
                dec: "दिसंबर",
                monthlyPL: "मासिक P/L",
                pl: "P/L"
            },
            'en': {
                appTitle: "Trading P/L Report Generator",
                appDescription: "Analyze your trading performance and generate detailed P/L reports",
                addTradeHeader: "Add New Trade",
                instrumentLabel: "Stock/Instrument",
                tradeTypeLabel: "Trade Type",
                quantityLabel: "Quantity",
                priceLabel: "Price Per Unit",
                dateLabel: "Date",
                addTradeBtn: "Add Trade",
                resetBtn: "Reset Form",
                tradeListHeader: "Trades List",
                noTradesText: "No trades found",
                addTradePrompt: "Use the form above to add trades",
                positionHeader: "Current Position",
                noPositionText: "No active positions",
                settingsHeader: "Settings",
                currencyLabel: "Currency",
                languageLabel: "Language",
                reportHeader: "P/L Report Summary",
                totalProfitLabel: "Total Profit",
                totalLossLabel: "Total Loss",
                netPLLabel: "Net P/L",
                winRateLabel: "Win Rate",
                monthlyPerfLabel: "Monthly Performance",
                tradeDetailsHeader: "Detailed Trades List",
                instrumentHeader: "Instrument",
                typeHeader: "Type",
                quantityHeader: "Qty",
                priceHeader: "Price",
                dateHeader: "Date",
                plHeader: "P/L",
                actionHeader: "Action",
                exportBtnText: "Download Report (CSV)",
                noDataText: "No trade data available",
                fillAllFields: "Please fill all fields",
                noDataExport: "No data to export",
                buy: "Buy",
                sell: "Sell",
                delete: "Delete",
                jan: "January",
                feb: "February",
                mar: "March",
                apr: "April",
                may: "May",
                jun: "June",
                jul: "July",
                aug: "August",
                sep: "September",
                oct: "October",
                nov: "November",
                dec: "December",
                monthlyPL: "Monthly P/L",
                pl: "P/L"
            }
        };
        
        // आज की तारीख सेट करें
        document.getElementById('date').valueAsDate = new Date();
        
        // सेटिंग्स लोड करें
        document.getElementById('currency').value = userSettings.currency;
        document.getElementById('language').value = userSettings.language;
        
        // सेटिंग्स परिवर्तन
        document.getElementById('currency').addEventListener('change', function() {
            userSettings.currency = this.value;
            saveSettings();
            updateUI();
            updateSummary();
            updateChart();
        });
        
        document.getElementById('language').addEventListener('change', function() {
            userSettings.language = this.value;
            saveSettings();
            updateUI();
        });
        
        // सेटिंग्स सहेजें
        function saveSettings() {
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
        }
        
        // UI अपडेट करें
        function updateUI() {
            const lang = userSettings.language;
            const trans = translations[lang];
            
            // हेडर अपडेट करें
            document.getElementById('appTitle').textContent = trans.appTitle;
            document.getElementById('appDescription').textContent = trans.appDescription;
            
            // इनपुट सेक्शन
            document.getElementById('addTradeHeader').textContent = trans.addTradeHeader;
            document.getElementById('instrumentLabel').textContent = trans.instrumentLabel;
            document.getElementById('tradeTypeLabel').textContent = trans.tradeTypeLabel;
            document.getElementById('quantityLabel').textContent = trans.quantityLabel;
            document.getElementById('priceLabel').textContent = trans.priceLabel;
            document.getElementById('dateLabel').textContent = trans.dateLabel;
            document.getElementById('addTradeBtn').textContent = trans.addTradeBtn;
            document.getElementById('resetBtn').textContent = trans.resetBtn;
            document.getElementById('tradeListHeader').textContent = trans.tradeListHeader;
            document.getElementById('noTradesText').textContent = trans.noTradesText;
            document.getElementById('addTradePrompt').textContent = trans.addTradePrompt;
            document.getElementById('positionHeader').textContent = trans.positionHeader;
            document.getElementById('noPositionText').textContent = trans.noPositionText;
            document.getElementById('settingsHeader').textContent = trans.settingsHeader;
            document.getElementById('currencyLabel').textContent = trans.currencyLabel;
            document.getElementById('languageLabel').textContent = trans.languageLabel;
            
            // आउटपुट सेक्शन
            document.getElementById('reportHeader').textContent = trans.reportHeader;
            document.getElementById('tradeDetailsHeader').textContent = trans.tradeDetailsHeader;
            document.getElementById('exportBtnText').textContent = trans.exportBtnText;
            document.getElementById('totalProfitLabel').textContent = trans.totalProfitLabel;
            document.getElementById('totalLossLabel').textContent = trans.totalLossLabel;
            document.getElementById('netPLLabel').textContent = trans.netPLLabel;
            document.getElementById('winRateLabel').textContent = trans.winRateLabel;
            document.getElementById('monthlyPerfLabel').textContent = trans.monthlyPerfLabel;
            document.getElementById('instrumentHeader').textContent = trans.instrumentHeader;
            document.getElementById('typeHeader').textContent = trans.typeHeader;
            document.getElementById('quantityHeader').textContent = trans.quantityHeader;
            document.getElementById('priceHeader').textContent = trans.priceHeader;
            document.getElementById('dateHeader').textContent = trans.dateHeader;
            document.getElementById('plHeader').textContent = trans.plHeader;
            document.getElementById('actionHeader').textContent = trans.actionHeader;
            document.getElementById('noDataText').textContent = trans.noDataText;
            
            // डेटा रीरेंडर करें
            renderTradesList();
            renderTradeTable();
            renderPositions();
            updateSummary();
            updateChart();
        }
        
        // करेंसी फॉर्मेट करें
        function formatCurrency(value) {
            const symbol = currencySymbols[userSettings.currency];
            return `${symbol}${Math.abs(value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }
        
        // ट्रेड जोड़ने का फंक्शन
        document.getElementById('addTrade').addEventListener('click', function() {
            const symbol = document.getElementById('symbol').value.trim();
            const type = document.getElementById('type').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const price = parseFloat(document.getElementById('price').value);
            const date = document.getElementById('date').value;
            
            if (!symbol || isNaN(quantity) || isNaN(price) || !date) {
                alert(translations[userSettings.language].fillAllFields);
                return;
            }
            
            // ट्रेड ऑब्जेक्ट बनाएं
            const trade = {
                id: Date.now(),
                symbol: symbol.toUpperCase(),
                type,
                quantity,
                price,
                date
            };
            
            // ट्रेड्स सरणी में जोड़ें
            trades.push(trade);
            
            // लोकल स्टोरेज में सहेजें
            localStorage.setItem('trades', JSON.stringify(trades));
            
            // UI अपडेट करें
            renderTradesList();
            renderTradeTable();
            renderPositions();
            updateSummary();
            updateChart();
            
            // फॉर्म रीसेट करें
            document.getElementById('symbol').value = '';
            document.getElementById('price').value = '';
        });
        
        // ट्रेड हटाने का फंक्शन
        function deleteTrade(id) {
            trades = trades.filter(trade => trade.id !== id);
            localStorage.setItem('trades', JSON.stringify(trades));
            renderTradesList();
            renderTradeTable();
            renderPositions();
            updateSummary();
            updateChart();
        }
        
        // फॉर्म रीसेट करें
        document.getElementById('resetForm').addEventListener('click', function() {
            document.getElementById('symbol').value = '';
            document.getElementById('quantity').value = '100';
            document.getElementById('price').value = '';
            document.getElementById('date').valueAsDate = new Date();
        });
        
        // P/L कैलकुलेट करें (FIFO विधि)
        function calculatePL(symbol) {
            const relevantTrades = trades
                .filter(trade => trade.symbol === symbol)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let buyQueue = [];
            let realizedPL = 0;
            
            for (const trade of relevantTrades) {
                if (trade.type === 'buy') {
                    buyQueue.push({
                        id: trade.id,
                        quantity: trade.quantity,
                        price: trade.price
                    });
                } else {
                    let sellQuantity = trade.quantity;
                    
                    while (sellQuantity > 0 && buyQueue.length > 0) {
                        const buyLot = buyQueue[0];
                        const quantityToUse = Math.min(buyLot.quantity, sellQuantity);
                        
                        // P/L = (बिक्री मूल्य - खरीद मूल्य) * मात्रा
                        realizedPL += (trade.price - buyLot.price) * quantityToUse;
                        
                        // खरीदी गई मात्रा अपडेट करें
                        buyLot.quantity -= quantityToUse;
                        sellQuantity -= quantityToUse;
                        
                        // यदि खरीदी गई मात्रा शून्य हो जाए तो कतार से हटाएं
                        if (buyLot.quantity === 0) {
                            buyQueue.shift();
                        }
                    }
                }
            }
            
            return realizedPL;
        }
        
        // ट्रेड्स सूची रेंडर करें
        function renderTradesList() {
            if (trades.length === 0) {
                tradesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>${translations[userSettings.language].noTradesText}</p>
                        <p>${translations[userSettings.language].addTradePrompt}</p>
                    </div>
                `;
                return;
            }
            
            tradesList.innerHTML = '';
            
            // प्रत्येक स्टॉक के लिए P/L कैलकुलेट करें
            const plBySymbol = {};
            const symbols = [...new Set(trades.map(trade => trade.symbol))];
            symbols.forEach(symbol => {
                plBySymbol[symbol] = calculatePL(symbol);
            });
            
            trades.forEach(trade => {
                const tradeItem = document.createElement('div');
                tradeItem.className = 'trade-item';
                tradeItem.dataset.id = trade.id;
                
                const isBuyTrade = trade.type === 'buy';
                const plText = isBuyTrade ? '' : formatCurrency(plBySymbol[trade.symbol]);
                const plClass = isBuyTrade ? '' : (plBySymbol[trade.symbol] >= 0 ? 'profit' : 'loss');
                
                tradeItem.innerHTML = `
                    <div>
                        <span class="symbol">${trade.symbol}</span> - 
                        <span>${trade.type === 'buy' ? translations[userSettings.language].buy : translations[userSettings.language].sell}</span>
                    </div>
                    <div>
                        <span class="${plClass}">
                            ${plText}
                        </span>
                        <span class="delete-btn" onclick="deleteTrade(${trade.id})">
                            <i class="fas fa-times"></i>
                        </span>
                    </div>
                `;
                
                tradesList.appendChild(tradeItem);
            });
        }
        
        // ट्रेड टेबल रेंडर करें
        function renderTradeTable() {
            if (trades.length === 0) {
                tradeTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-table"></i>
                            <p>${translations[userSettings.language].noDataText}</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tradeTableBody.innerHTML = '';
            
            // प्रत्येक स्टॉक के लिए P/L कैलकुलेट करें
            const plBySymbol = {};
            const symbols = [...new Set(trades.map(trade => trade.symbol))];
            symbols.forEach(symbol => {
                plBySymbol[symbol] = calculatePL(symbol);
            });
            
            trades.forEach(trade => {
                const tr = document.createElement('tr');
                const isBuyTrade = trade.type === 'buy';
                const plFormatted = !isBuyTrade ? formatCurrency(plBySymbol[trade.symbol]) : '';
                const plClass = !isBuyTrade ? (plBySymbol[trade.symbol] >= 0 ? 'profit' : 'loss') : '';
                
                tr.innerHTML = `
                    <td>${trade.symbol}</td>
                    <td>${trade.type === 'buy' ? translations[userSettings.language].buy : translations[userSettings.language].sell}</td>
                    <td>${trade.quantity}</td>
                    <td>${formatCurrency(trade.price)}</td>
                    <td>${formatDate(trade.date)}</td>
                    <td class="${plClass}">${plFormatted}</td>
                    <td>
                        <button class="delete-btn" onclick="deleteTrade(${trade.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tradeTableBody.appendChild(tr);
            });
        }
        
        // पोजीशन रेंडर करें
        function renderPositions() {
            // पोजीशन कैलकुलेट करें
            const positions = {};
            
            trades.forEach(trade => {
                if (trade.type === 'buy') {
                    if (!positions[trade.symbol]) {
                        positions[trade.symbol] = {
                            quantity: 0,
                            totalValue: 0
                        };
                    }
                    positions[trade.symbol].quantity += trade.quantity;
                    positions[trade.symbol].totalValue += trade.quantity * trade.price;
                }
            });
            
            if (Object.keys(positions).length === 0) {
                positionsContainer.innerHTML = `
                    <div class="empty-state" style="padding: 15px;">
                        <i class="fas fa-box-open"></i>
                        <p>${translations[userSettings.language].noPositionText}</p>
                    </div>
                `;
                return;
            }
            
            positionsContainer.innerHTML = '';
            
            for (const symbol in positions) {
                const position = positions[symbol];
                const positionItem = document.createElement('div');
                positionItem.className = 'position-item';
                
                const avgPrice = position.totalValue / position.quantity;
                
                positionItem.innerHTML = `
                    <div>
                        <strong>${symbol}</strong><br>
                        <span>${translations[userSettings.language].buy}: ${position.quantity} @ ${formatCurrency(avgPrice)}</span>
                    </div>
                    <div>
                        <span>${translations[userSettings.language].pl}: ${formatCurrency(calculatePL(symbol))}</span>
                    </div>
                `;
                
                positionsContainer.appendChild(positionItem);
            }
        }
        
        // सारांश अपडेट करें
        function updateSummary() {
            let totalProfitValue = 0;
            let totalLossValue = 0;
            let profitableSymbols = 0;
            let totalSymbols = 0;
            
            // प्रत्येक स्टॉक के लिए P/L कैलकुलेट करें
            const symbols = [...new Set(trades.map(trade => trade.symbol))];
            symbols.forEach(symbol => {
                const pl = calculatePL(symbol);
                if (pl > 0) {
                    totalProfitValue += pl;
                    profitableSymbols++;
                } else if (pl < 0) {
                    totalLossValue += Math.abs(pl);
                }
                totalSymbols++;
            });
            
            const netPLValue = totalProfitValue - totalLossValue;
            const winRateValue = totalSymbols > 0 ? 
                Math.round((profitableSymbols / totalSymbols) * 100) : 0;
            
            totalProfit.textContent = formatCurrency(totalProfitValue);
            totalLoss.textContent = formatCurrency(totalLossValue);
            netPL.textContent = formatCurrency(netPLValue);
            winRate.textContent = `${winRateValue}%`;
            
            // नेट P/L के लिए रंग अपडेट करें
            netPL.className = netPLValue >= 0 ? 'value profit-value' : 'value loss-value';
        }
        
        // चार्ट अपडेट करें
        let performanceChart = null;
        function updateChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // मासिक डेटा तैयार करें
            const months = [
                translations[userSettings.language].jan,
                translations[userSettings.language].feb,
                translations[userSettings.language].mar,
                translations[userSettings.language].apr,
                translations[userSettings.language].may,
                translations[userSettings.language].jun,
                translations[userSettings.language].jul,
                translations[userSettings.language].aug,
                translations[userSettings.language].sep,
                translations[userSettings.language].oct,
                translations[userSettings.language].nov,
                translations[userSettings.language].dec
            ];
            
            // मासिक P/L डेटा तैयार करें
            const monthlyData = Array(12).fill(0);
            
            // प्रत्येक स्टॉक के लिए P/L कैलकुलेट करें और महीने के अनुसार समूहित करें
            const symbols = [...new Set(trades.map(trade => trade.symbol))];
            symbols.forEach(symbol => {
                const pl = calculatePL(symbol);
                const month = new Date().getMonth(); // सरलता के लिए वर्तमान महीना
                monthlyData[month] += pl;
            });
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: `${translations[userSettings.language].monthlyPL} (${currencySymbols[userSettings.currency]})`,
                        data: monthlyData,
                        backgroundColor: monthlyData.map(value => 
                            value >= 0 ? 'rgba(0, 176, 155, 0.7)' : 'rgba(255, 65, 108, 0.7)'
                        ),
                        borderColor: monthlyData.map(value => 
                            value >= 0 ? 'rgb(0, 176, 155)' : 'rgb(255, 65, 108)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return currencySymbols[userSettings.currency] + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${translations[userSettings.language].pl}: ${currencySymbols[userSettings.currency]}${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // CSV एक्सपोर्ट
        document.getElementById('exportBtn').addEventListener('click', function() {
            if (trades.length === 0) {
                alert(translations[userSettings.language].noDataExport);
                return;
            }
            
            const lang = userSettings.language;
            const trans = translations[lang];
            
            let csvContent = `${trans.instrumentHeader},${trans.typeHeader},${trans.quantityHeader},${trans.priceHeader},${trans.dateHeader},${trans.plHeader}\n`;
            
            // प्रत्येक स्टॉक के लिए P/L कैलकुलेट करें
            const plBySymbol = {};
            const symbols = [...new Set(trades.map(trade => trade.symbol))];
            symbols.forEach(symbol => {
                plBySymbol[symbol] = calculatePL(symbol);
            });
            
            trades.forEach(trade => {
                const plValue = trade.type === 'buy' ? '' : plBySymbol[trade.symbol];
                
                csvContent += `"${trade.symbol}",`;
                csvContent += `"${trade.type === 'buy' ? trans.buy : trans.sell}",`;
                csvContent += `${trade.quantity},`;
                csvContent += `${trade.price},`;
                csvContent += `"${formatDate(trade.date)}",`;
                csvContent += `${plValue}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `trading_report_${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // सहायक फ़ंक्शन
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString(userSettings.language);
        }
        
        // पेज लोड होने पर डेटा प्रदर्शित करें
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
        });
        
        // ग्लोबल फंक्शन
        window.deleteTrade = deleteTrade;
    </script>
</body>
</html>